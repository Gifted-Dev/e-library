{% extends "base.html" %}

{% block title %}{{ book.title }} - LightBearers Library{% endblock %}

{% block content %}
<div class="container-fluid px-4 py-5 mx-lg-5">
    <div class="row">
        <div class="col-md-4">
            <img src="{% if book.cover_image %}/{{ book.cover_image }}{% else %}/static/images/default_cover.png{% endif %}" class="img-fluid rounded shadow-sm" alt="Cover for {{ book.title }}">
        </div>
        <div class="col-md-8">
            <h1>{{ book.title }}</h1>
            <h4 class="text-muted">by {{ book.author }}</h4>
            <hr>
            <p class="lead">{{ book.description }}</p>
            <ul class="list-unstyled text-muted mb-4">
                <li><strong>Upload Date:</strong> {{ book.upload_date.strftime('%B %d, %Y') }}</li>
                <li><strong>File Size:</strong> {{ "%.2f"|format(book.file_size) if book.file_size else 'N/A' }} MB</li>
            </ul>

            <div id="action-alert-container" class="mb-3"></div>

            <div class="d-flex align-items-center gap-2 flex-wrap">
                {% if current_user and current_user.is_verified %}
                    <button hx-post="/api/v1/books/{{ book.uid }}/request-download"
                            hx-target="#action-alert-container"
                            hx-swap="innerHTML"
                            class="btn btn-primary">
                        <i class="bi bi-download me-2"></i>Request Download Link
                    </button>
                {% elif current_user and not current_user.is_verified %}
                    <div class="alert alert-warning">Please verify your email from your profile page to request a download.</div>
                {% else %}
                    <div class="alert alert-info">Please <a href="#" data-bs-toggle="modal" data-bs-target="#loginModal" class="link-themed">log in</a> to request a download link.</div>
                {% endif %}

                {% if current_user and current_user.role in ['admin', 'superadmin'] %}
                <a href="/admin/edit-book/{{ book.uid }}" class="btn btn-secondary"><i class="bi bi-pencil-square me-2"></i>Edit Book</a>
                <button class="btn btn-danger"
                        hx-delete="/api/v1/books/delete-book/{{ book.uid }}"
                        hx-confirm="Are you sure you want to permanently delete this book? This cannot be undone."
                        hx-target="body">
                    <i class="bi bi-trash me-2"></i>Delete Book
                </button>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}